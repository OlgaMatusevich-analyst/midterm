<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HR Attrition — GRU (TensorFlow.js)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; line-height: 1.4; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; flex: 1; min-width: 300px; box-shadow: 0 2px 8px rgba(0,0,0,.04); }
    button { padding: 8px 14px; border-radius: 10px; border: 1px solid #e5e7eb; background: #111827; color: #fff; cursor: pointer; }
    button[disabled] { opacity: .5; cursor: not-allowed; }
    input[type="file"] { padding: 6px; }
    progress { width: 100%; height: 14px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: center; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
    .metric { font-weight: 600; }
    .small { font-size: 12px; color: #6b7280; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #eef2ff; color: #3730a3; font-size: 12px; }
    #logs { white-space: pre-wrap; max-height: 240px; overflow: auto; background: #0b1020; color: #e5e7eb; padding: 12px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>HR Attrition — GRU in the Browser</h1>
  <p class="small">Upload the IBM HR Attrition CSV. Train a GRU classifier entirely client-side. No servers.</p>

  <div class="row">
    <div class="card" style="max-width:480px">
      <h3>1) Data</h3>
      <input id="csvFile" type="file" accept=".csv,text/csv" />
      <div style="margin-top:8px">
        <label>Sequence length (timesteps)</label>
        <input id="seqLen" type="number" min="1" max="16" value="1" style="width:64px;margin-left:6px" />
        <span class="small">Sorted chronologically and windowed</span>
      </div>
      <div style="margin-top:8px">
        <label>Test split (%)</label>
        <input id="testSplit" type="number" min="10" max="50" value="20" style="width:64px;margin-left:6px" />
      </div>
      <div style="margin-top:8px">
        <span class="pill" id="dataStatus">No data</span>
      </div>
      <div style="margin-top:8px">
        <button id="prepBtn" disabled>Prepare Dataset</button>
      </div>
    </div>

    <div class="card">
      <h3>2) Train</h3>
      <div class="row" style="gap:8px">
        <div>
          <label>Epochs</label><br/>
          <input id="epochs" type="number" value="20" min="1" max="200" style="width:80px"/>
        </div>
        <div>
          <label>Batch</label><br/>
          <input id="batchSize" type="number" value="32" min="1" max="512" style="width:80px"/>
        </div>
        <div>
          <label>LR</label><br/>
          <input id="lr" type="number" value="0.001" step="0.0001" style="width:100px"/>
        </div>
        <div>
          <label>Units</label><br/>
          <input id="units" type="number" value="64" min="8" max="256" style="width:80px"/>
        </div>
        <div>
          <label>Layers</label><br/>
          <input id="layers" type="number" value="2" min="1" max="3" style="width:80px"/>
        </div>
      </div>
      <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
        <button id="buildBtn" disabled>Build Model</button>
        <button id="trainBtn" disabled>Train</button>
        <button id="evalBtn" disabled>Evaluate</button>
        <button id="saveBtn" disabled>Save Weights</button>
        <button id="loadBtn">Load Weights</button>
        <button id="resetBtn">Reset</button>
      </div>
      <div style="margin-top:10px">
        <progress id="prog" value="0" max="1"></progress>
        <div class="small">Progress</div>
      </div>
    </div>

    <div class="card">
      <h3>3) Metrics</h3>
      <div id="metrics">
        <div>Binary Accuracy: <span class="metric" id="mAcc">–</span></div>
        <div>Precision: <span class="metric" id="mPrec">–</span></div>
        <div>Recall: <span class="metric" id="mRec">–</span></div>
        <div>F1: <span class="metric" id="mF1">–</span></div>
        <div>ROC AUC: <span class="metric" id="mAUC">–</span></div>
      </div>
      <h4 style="margin-top:12px">Confusion Matrix (Test)</h4>
      <table>
        <thead><tr><th></th><th>Pred 0</th><th>Pred 1</th></tr></thead>
        <tbody>
          <tr><td>True 0</td><td id="cmTN">–</td><td id="cmFP">–</td></tr>
          <tr><td>True 1</td><td id="cmFN">–</td><td id="cmTP">–</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <h3>Logs</h3>
    <div id="logs" class="mono"></div>
  </div>

  <script type="module">
    import { DataLoader } from './data-loader.js';
    import { GRUClassifier } from './gru.js';
    import { App } from './app.js';

    const dl = new DataLoader({log: logLine});
    const model = new GRUClassifier({log: logLine});

    const app = new App({ tf, dl, model, ui: {
      csvFile: document.getElementById('csvFile'),
      prepBtn: document.getElementById('prepBtn'),
      buildBtn: document.getElementById('buildBtn'),
      trainBtn: document.getElementById('trainBtn'),
      evalBtn: document.getElementById('evalBtn'),
      saveBtn: document.getElementById('saveBtn'),
      loadBtn: document.getElementById('loadBtn'),
      resetBtn: document.getElementById('resetBtn'),
      seqLen: document.getElementById('seqLen'),
      testSplit: document.getElementById('testSplit'),
      epochs: document.getElementById('epochs'),
      batchSize: document.getElementById('batchSize'),
      lr: document.getElementById('lr'),
      units: document.getElementById('units'),
      layers: document.getElementById('layers'),
      prog: document.getElementById('prog'),
      dataStatus: document.getElementById('dataStatus'),
      // metrics + confusion matrix
      elAcc: document.getElementById('mAcc'),
      elPrec: document.getElementById('mPrec'),
      elRec: document.getElementById('mRec'),
      elF1: document.getElementById('mF1'),
      elAUC: document.getElementById('mAUC'),
      cmTN: document.getElementById('cmTN'),
      cmFP: document.getElementById('cmFP'),
      cmFN: document.getElementById('cmFN'),
      cmTP: document.getElementById('cmTP'),
    }});

    function logLine(msg) {
      const el = document.getElementById('logs');
      const t = new Date().toLocaleTimeString();
      el.textContent += `[${t}] ${msg}\n`;
      el.scrollTop = el.scrollHeight;
    }
  </script>
</body>
</html>
